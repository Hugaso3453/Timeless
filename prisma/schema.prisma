// ------------------------------------------------------
//  DATA SOURCE & GENERATOR
// ------------------------------------------------------
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // or "postgresql" if preferred
  url      = env("DATABASE_URL")
}

// ------------------------------------------------------
//  ENUMS
// ------------------------------------------------------
enum UserRole {
  ADMIN
  EMPLOYEE
  CUSTOMER
}

enum MediaType {
  IMAGE
  VIDEO
}

// For listing cars
enum Condition {
  NEW
  USED
  DEMO
}

enum AvailabilityStatus {
  AVAILABLE
  RESERVED
  SOLD
}

enum FuelType {
  PETROL
  DIESEL
  HYBRID
  ELECTRIC
  OTHER
}

enum DriveType {
  FWD
  RWD
  AWD
  FOUR_WD
}

// ------------------------------------------------------
//  TABLE 1 — USER
// ------------------------------------------------------
model User {
  id            Int       @id @default(autoincrement())
  name          String?
  email         String    @unique
  passwordHash  String
  role          UserRole  @default(CUSTOMER)

  // For reservation system
  reservedVehicles Vehicle[] @relation("ReservedByUser")

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// ------------------------------------------------------
//  TABLE 2 — DEALERSHIP (REGIONS)
// ------------------------------------------------------
model Dealership {
  id        Int      @id @default(autoincrement())
  name      String
  slug      String   @unique
  country   String
  region    String
  city      String
  address   String?
  phone     String?
  email     String?
  latitude  Float?
  longitude Float?

  vehicles  Vehicle[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ------------------------------------------------------
//  TABLE 3 — VEHICLE (THE MAIN ENTITY)
// ------------------------------------------------------
model Vehicle {
  id                Int       @id @default(autoincrement())
  dealershipId      Int
  dealership        Dealership @relation(fields: [dealershipId], references: [id])

  slug              String     @unique
  brand             String
  model             String
  variant           String?
  year              Int
  firstRegistration Int?

  vin               String?    @unique
  stockNumber       String?    @unique

  // Listing & used-car related
  price             Float
  currency          String     @default("EUR")
  mileageKm         Int?
  previousOwners    Int?
  condition         Condition  @default(USED)
  warrantyType      String?
  warrantyExpiry    DateTime?
  itvValidUntil     DateTime?

  availability      AvailabilityStatus @default(AVAILABLE)
  reservedByUserId  Int?      
  reservedByUser    User?    @relation("ReservedByUser", fields: [reservedByUserId], references: [id])
  reservedUntil     DateTime?

  // Marketing content (for templates)
  heroTitle         String?
  heroSubtitle      String?
  heroTaglineTitle  String?
  heroTaglineBody   String?
  heroVideoUrl      String?

  // Highlight stats (for animated counters)
  highlight_0_100_s   Float?
  highlight_power_kw  Float?
  highlight_power_hp  Float?
  highlight_top_speed Float?

  // ------------------------------------------------------
  // PERFORMANCE
  // ------------------------------------------------------
  powerTotalHp               Float?
  maxSpeedLimitedKmh         Float?
  maxSpeedUnlockedKmh        Float?
  massDinKg                  Float?
  electricRangeWltpKm        Float?

  // ACCELERATION
  accel_0_100_s              Float?
  accel_0_200_s              Float?
  accel_0_300_s              Float?
  accel_0_400_s              Float?

  // COMBUSTION ENGINE
  engineConfiguration        String?
  engineArchitecture         String?
  engineDisplacementL        Float?
  enginePowerHp              Float?
  engineTorqueNm             Float?
  engineMaxRpm               Int?

  // DIMENSIONS
  lengthMm                   Int?
  widthMm                    Int?
  widthWithMirrorsMm         Int?
  heightMm                   Int?
  wheelbaseMm                Int?

  // TRANSMISSION
  transmissionType           String?
  elsdDescription            String?
  eSynchroDescription        String?
  transmissionCooling        String?

  // FRONT AXLE / EV SECTION
  frontMotorLayout           String?
  frontMotorPowerKwTotal     Float?
  frontMotorTorqueNmWheels   Float?
  frontMotorMaxRpm           Int?
  frontMotorType             String?
  frontInverterType          String?
  frontDriveSystem           String?

  // BATTERY SYSTEM
  batteryArchitectureV       Int?
  batteryPowerPeakKw         Float?
  batteryEnergyKwh           Float?
  batteryCooling             String?

  // REAR EMOTOR
  rearMotorPowerKw           Float?
  rearMotorTorqueNm          Float?
  rearMotorMaxRpm            Int?
  rearMotorType              String?
  rearInverterType           String?

  // GENERIC CAR ATTRIBUTES
  bodyType                   String?
  doors                      Int?
  seats                      Int?
  driveType                  DriveType?
  fuelType                   FuelType?
  exteriorColor              String?
  interiorColor              String?
  upholstery                 String?
  optionsSummary             String?
  description                String?

  // Media relation
  media                      MediaAsset[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ------------------------------------------------------
//  TABLE 4 — MEDIA ASSET (IMAGES / VIDEOS PER VEHICLE)
// ------------------------------------------------------
model MediaAsset {
  id         Int       @id @default(autoincrement())
  vehicleId  Int
  vehicle    Vehicle   @relation(fields: [vehicleId], references: [id])

  type       MediaType
  url        String
  alt        String?
  isHero     Boolean   @default(false)
  sortOrder  Int       @default(0)

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}
