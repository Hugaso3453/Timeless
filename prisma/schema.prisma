generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int             @id @default(autoincrement())
  name             String?
  email            String?         @unique
  passwordHash     String?
  role             UserRole        @default(CUSTOMER)
  disabled         Boolean         @default(false)
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  emailVerified    DateTime?
  image            String?
  accounts         Account[]
  authenticators   Authenticator[]
  sessions         Session[]
  reservedVehicles Vehicle[]       @relation("ReservedByUser")
}

model Dealership {
  id        Int       @id @default(autoincrement())
  name      String
  slug      String    @unique
  country   String
  region    String
  city      String
  address   String?
  phone     String?
  email     String?
  latitude  Float?
  longitude Float?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  vehicles  Vehicle[]
}

model Vehicle {
  id                       Int                @id @default(autoincrement())
  dealershipId             Int
  slug                     String             @unique
  brand                    String
  model                    String
  variant                  String?
  year                     Int
  firstRegistration        Int?
  vin                      String?            @unique
  stockNumber              String?            @unique
  price                    Float
  currency                 String             @default("EUR")
  mileageKm                Int?
  previousOwners           Int?
  condition                Condition          @default(USED)
  warrantyType             String?
  warrantyExpiry           DateTime?
  itvValidUntil            DateTime?
  availability             AvailabilityStatus @default(AVAILABLE)
  reservedByUserId         Int?
  reservedUntil            DateTime?
  heroTitle                String?
  heroSubtitle             String?
  heroTaglineTitle         String?
  heroTaglineBody          String?
  heroVideoUrl             String?
  highlight_0_100_s        Float?
  highlight_power_kw       Float?
  highlight_power_hp       Float?
  highlight_top_speed      Float?
  powerTotalHp             Float?
  maxSpeedLimitedKmh       Float?
  maxSpeedUnlockedKmh      Float?
  massDinKg                Float?
  electricRangeWltpKm      Float?
  accel_0_100_s            Float?
  accel_0_200_s            Float?
  accel_0_300_s            Float?
  accel_0_400_s            Float?
  engineConfiguration      String?
  engineArchitecture       String?
  engineDisplacementL      Float?
  enginePowerHp            Float?
  engineTorqueNm           Float?
  engineMaxRpm             Int?
  lengthMm                 Int?
  widthMm                  Int?
  widthWithMirrorsMm       Int?
  heightMm                 Int?
  wheelbaseMm              Int?
  transmissionType         String?
  elsdDescription          String?
  eSynchroDescription      String?
  transmissionCooling      String?
  frontMotorLayout         String?
  frontMotorPowerKwTotal   Float?
  frontMotorTorqueNmWheels Float?
  frontMotorMaxRpm         Int?
  frontMotorType           String?
  frontInverterType        String?
  frontDriveSystem         String?
  batteryArchitectureV     Int?
  batteryPowerPeakKw       Float?
  batteryEnergyKwh         Float?
  batteryCooling           String?
  rearMotorPowerKw         Float?
  rearMotorTorqueNm        Float?
  rearMotorMaxRpm          Int?
  rearMotorType            String?
  rearInverterType         String?
  bodyType                 String?
  doors                    Int?
  seats                    Int?
  driveType                DriveType?
  fuelType                 FuelType?
  exteriorColor            String?
  interiorColor            String?
  upholstery               String?
  optionsSummary           String?
  description              String?
  createdAt                DateTime           @default(now())
  updatedAt                DateTime           @updatedAt
  thumbnailUrl             String?
  media                    MediaAsset[]
  dealership               Dealership         @relation(fields: [dealershipId], references: [id])
  reservedByUser           User?              @relation("ReservedByUser", fields: [reservedByUserId], references: [id])
}

model MediaAsset {
  id        Int       @id @default(autoincrement())
  vehicleId Int
  type      MediaType
  url       String
  alt       String?
  isHero    Boolean   @default(false)
  sortOrder Int       @default(0)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  vehicle   Vehicle   @relation(fields: [vehicleId], references: [id])
}

model Account {
  id                Int     @id @default(autoincrement())
  userId            Int
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           Int      @id @default(autoincrement())
  sessionToken String   @unique
  userId       Int
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Authenticator {
  credentialID        String  @id
  userId              Int
  credentialPublicKey Bytes
  counter             Int
  credentialBackedUp  Boolean
  transports          String?
  user                User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum UserRole {
  ADMIN
  EMPLOYEE
  CUSTOMER
}

enum MediaType {
  IMAGE
  VIDEO
}

enum Condition {
  NEW
  USED
  DEMO
}

enum AvailabilityStatus {
  AVAILABLE
  RESERVED
  SOLD
}

enum FuelType {
  PETROL
  DIESEL
  HYBRID
  ELECTRIC
  OTHER
}

enum DriveType {
  FWD
  RWD
  AWD
  FOUR_WD
}
